name: DEBUG - Inspect Build Artifacts

on:
  push:
    tags:
      - "v*-debug"

jobs:
  build-and-inspect:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m venv .venv
          .\.venv\Scripts\Activate.ps1
          pip install -r dev-requirements.txt

      - name: Build the application
        run: .\build\build.bat

      - name: Upload Installer for Inspection
        uses: actions/upload-artifact@v4
        with:
          name: installer-for-inspection
          path: dist/NetSpeedTray-*/NetSpeedTray-*-Setup.exe

      - name: Download and Inspect Artifact
        run: |
          # Download the artifact we just uploaded into a directory named 'debug'
          gh artifact download installer-for-inspection --dir debug
          
          echo "---"
          echo "--- ARTIFACT CONTENTS ---"
          echo "The exact file path inside the artifact is shown below:"
          echo "---"
          
          # List the full directory tree of the downloaded artifact
          dir debug /s
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}